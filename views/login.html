<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Barber√≠a - Autenticaci√≥n</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: url("../public/assets/img/barber-shop-background-5vtx4y41tzf8axue.jpg") no-repeat center center/cover;
    }

    .auth-box {
      background: rgba(0, 0, 0, 0.7);
      padding: 2rem;
      border-radius: 1rem;
      width: 100%;
      max-width: 380px;
      color: #fff;
      box-shadow: 0 0 15px rgba(0,0,0,0.5);
      text-align: center;
    }

    h2 {
      margin-bottom: 1rem;
      color: #38bdf8;
    }

    form {
      display: none;
      text-align: left;
    }

    form.active {
      display: block;
    }

    form input {
      width: 100%;
      padding: 0.8rem;
      margin: 0.5rem 0;
      border: none;
      border-radius: 25px;
      outline: none;
      background: rgba(255,255,255,0.1);
      color: #fff;
    }

    form input::placeholder {
      color: #aaa;
    }

    form button {
      width: 100%;
      padding: 0.8rem;
      border: none;
      border-radius: 25px;
      background: #38bdf8;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      margin-top: 1rem;
      transition: 0.3s;
    }

    form button:hover {
      background: #0ea5e9;
    }

    .options {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.85rem;
      margin: 0.5rem 0;
    }

    .options label {
      display: flex;
      align-items: center;
      gap: 5px;
      cursor: pointer;
    }

    .options a {
      color: #38bdf8;
      text-decoration: none;
    }

    .register-link {
      text-align: center;
      margin-top: 1rem;
      font-size: 0.85rem;
      color: #bbb;
    }

    .register-link a {
      color: #38bdf8;
      font-weight: bold;
      text-decoration: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="auth-box">
    <h2 id="form-title">Iniciar Sesi√≥n</h2>

    <!-- Formulario de login -->
    <form id="login-form" class="active">
      <input type="email" id="login-correo" placeholder="Correo electr√≥nico" required>
      <input type="password" id="login-password" placeholder="Contrase√±a" required>
      <div class="options">
        <label><input type="checkbox"> Recordarme</label>
        <a href="#" id="forgot-password">¬øOlvidaste tu contrase√±a?</a>
      </div>
      <button type="submit">Ingresar</button>
      <p class="register-link">¬øNo tienes cuenta? <a href="#" id="go-register">Reg√≠strate</a></p>
    </form>

    <!-- Formulario de registro -->
    <form id="register-form">
      <input type="text" id="nombre" placeholder="Nombre" required>
      <input type="text" id="apellidos" placeholder="Apellidos" required>
      <input type="email" id="correo" placeholder="Correo electr√≥nico" required>
      <input type="tel" id="telefono" placeholder="Tel√©fono" required>
      <input type="password" id="password" placeholder="Contrase√±a" required>
      <input type="date" id="fechaNacimiento" required>
      <button type="submit">Crear Cuenta</button>
      <p class="register-link">¬øYa tienes cuenta? <a href="#" id="go-login">Inicia Sesi√≥n</a></p>
    </form>
  </div>

  <script>
    const loginForm = document.getElementById("login-form");
    const registerForm = document.getElementById("register-form");
    const title = document.getElementById("form-title");
    const goRegister = document.getElementById("go-register");
    const goLogin = document.getElementById("go-login");
    const forgotPasswordLink = document.getElementById("forgot-password");

    // Cambiar entre login y registro
    goRegister.addEventListener("click", (e) => {
      e.preventDefault();
      loginForm.classList.remove("active");
      registerForm.classList.add("active");
      title.textContent = "Registrarse";
    });

    goLogin.addEventListener("click", (e) => {
      e.preventDefault();
      registerForm.classList.remove("active");
      loginForm.classList.add("active");
      title.textContent = "Iniciar Sesi√≥n";
    });

    // Guardar usuarios en localStorage
    const saveUser = (user) => {
      let users = JSON.parse(localStorage.getItem("users")) || [];
      
      // üëë Si es el primer usuario registrado => superadmin
      if (users.length === 0) {
        user.rol = "superadmin";
      } else {
        user.rol = "usuario";
      }

      users.push(user);
      localStorage.setItem("users", JSON.stringify(users));
    };

    // Buscar usuario
    const findUser = (correo, password) => {
      let users = JSON.parse(localStorage.getItem("users")) || [];
      return users.find(u => u.correo === correo && u.password === password);
    };

    // Registro
    registerForm.addEventListener("submit", (e) => {
      e.preventDefault();

      const user = {
        nombre: document.getElementById("nombre").value,
        apellidos: document.getElementById("apellidos").value,
        correo: document.getElementById("correo").value,
        telefono: document.getElementById("telefono").value,
        password: document.getElementById("password").value,
        fechaNacimiento: document.getElementById("fechaNacimiento").value
      };

      saveUser(user);

      alert("‚úÖ Registro exitoso. Ahora puedes iniciar sesi√≥n.");
      goLogin.click();
    });

    // Login
    loginForm.addEventListener("submit", (e) => {
      e.preventDefault();

      const correo = document.getElementById("login-correo").value;
      const password = document.getElementById("login-password").value;

      const user = findUser(correo, password);

      if (user) {
        alert(`üëã Bienvenido ${user.nombre} ${user.apellidos}`);
        
        if (user.rol === "superadmin") {
          window.location.href = "superadmin.html"; // solo superadmin
        } else {
          window.location.href = "dasboard/dasboard.html"; // usuarios normales
        }
      } else {
        alert("‚ùå Correo o contrase√±a incorrectos.");
      }
    });

    // Recuperar contrase√±a (restablecer)
    forgotPasswordLink.addEventListener("click", (e) => {
      e.preventDefault();
      
      const correo = prompt("üìß Ingresa tu correo electr√≥nico registrado:");
      if (!correo) return;

      let users = JSON.parse(localStorage.getItem("users")) || [];
      const userIndex = users.findIndex(u => u.correo === correo);

      if (userIndex !== -1) {
        const nuevaPassword = prompt("üîë Ingresa tu nueva contrase√±a:");
        if (nuevaPassword) {
          users[userIndex].password = nuevaPassword;
          localStorage.setItem("users", JSON.stringify(users));
          alert("‚úÖ Contrase√±a actualizada correctamente. Ahora puedes iniciar sesi√≥n.");
        } else {
          alert("‚ùå No ingresaste ninguna contrase√±a nueva.");
        }
      } else {
        alert("‚ùå No existe ninguna cuenta con ese correo.");
      }
    });
  </script>
</body>
</html>
